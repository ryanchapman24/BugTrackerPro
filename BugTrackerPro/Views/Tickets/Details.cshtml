@model BugTrackerPro.Models.CodeFirst.Ticket
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Details";
}

<link rel="stylesheet" type="text/css" href="../../assets/widgets/tocify/tocify.css">
<link rel="stylesheet" type="text/css" href="../../assets/widgets/tabs-ui/tabs.css">
<style>
    #tocify-menu ul {
        margin-bottom: 0px;
    }

    .right-to-left .tabsy {
        float: right;
    }
</style>
<script type="text/javascript" src="../../assets/widgets/tabs-ui/tabs.js"></script>
<script type="text/javascript">
    /* jQuery UI Tabs */

    $(function () {
        "use strict";
        $(".tabs").tabs();
    });

    $(function () {
        "use strict";
        $(".tabs-hover").tabs({
            event: "mouseover"
        });
    });
</script>
<!-- Boostrap Tabs -->
<script type="text/javascript" src="../../assets/widgets/tabs/tabs.js"></script>
<!-- Tabdrop Responsive -->
<script type="text/javascript" src="../../assets/widgets/tabs/tabs-responsive.js"></script>
<script type="text/javascript">
    /* Responsive tabs */
    $(function () {
        "use strict";
        $('.nav-responsive').tabdrop();
    });
</script>

<div class="example-box-wrapper">
    <ul id="myTab" class="nav clearfix nav-tabs right-to-left">
        <li class="tabsy"><a href="#history" data-toggle="tab" style="text-decoration: none; border-right: 1px solid #dfe8f1; border-left: 1px solid #dfe8f1; border-top: 1px solid #dfe8f1; padding-left: 50px; padding-right: 50px">History</a></li>
        <li class="active tabsy"><a href="#details" data-toggle="tab" style="text-decoration: none; border-right: 1px solid #dfe8f1; border-left: 1px solid #dfe8f1; border-top: 1px solid #dfe8f1; padding-left: 50px; padding-right: 50px">Details</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade active in" id="details">
            <h2 style="margin-bottom: 40px">Ticket Details | <span style="color: #00bca4">#@Model.Id - @Model.Title</span><a href="@Url.Action("Index", "Home")" class="btn btn-black pull-right"><i class="glyph-icon icon-linecons-tag" style="margin-right: 10px"></i>Back to Tickets</a></h2>
            <div class="row">
                <div class="col-md-3">
                    <div class="sticky-nav">
                        <div id="tocify-menu"></div>
                    </div>
                </div>
                <div class="col-md-9" style="margin-bottom: 600px">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="ribbon ribbon-tr">
                                @if (Model.TicketPriority.Name == "Low")
                                {
                                    <div class="bg-blue-alt">@Model.TicketPriority.Name</div>
                                }
                                else if (Model.TicketPriority.Name == "Medium")
                                {
                                    <div class="bg-yellow">@Model.TicketPriority.Name</div>
                                }
                                else if (Model.TicketPriority.Name == "High")
                                {
                                    <div class="bg-orange">@Model.TicketPriority.Name</div>
                                }
                                else if (Model.TicketPriority.Name == "Critical")
                                {
                                    <div class="bg-red">@Model.TicketPriority.Name</div>
                                }
                            </div>

                            <div style="text-align: center">
                                <center>
                                    <h1 style="margin-top: 30px; margin-bottom: -50px">
                                        <span class="bs-label label-primary">
                                            <strong>
                                                <i class="glyph-icon icon-linecons-tag" style="margin-right: 10px"></i>
                                                <span style="font-size: 15px">#</span><span style="margin-left: 3px">@Model.Id</span>
                                            </strong>
                                        </span>
                                    </h1>
                                </center>
                            </div>
                            <div class="toc-tocify">
                                <h2 class="mrg20B" style="padding-top: 100px">Details</h2>
                                <div class="content-box pad20A">
                                    @*<div class="ribbon ribbon-tr">
                                        @if (Model.TicketPriority.Name == "Low")
                                        {
                                            <div class="bg-blue-alt">@Model.TicketPriority.Name</div>
                                        }
                                        else if (Model.TicketPriority.Name == "Medium")
                                        {
                                            <div class="bg-yellow">@Model.TicketPriority.Name</div>
                                        }
                                        else if (Model.TicketPriority.Name == "High")
                                        {
                                            <div class="bg-orange">@Model.TicketPriority.Name</div>
                                        }
                                        else if (Model.TicketPriority.Name == "Critical")
                                        {
                                            <div class="bg-red">@Model.TicketPriority.Name</div>
                                        }
                                    </div>*@
                                    <div class="row" style="margin-bottom: 20px; margin-top: 20px">
                                        <div class="col-md-6">
                                            <center>
                                                <div class="content-box border-top border-primary">
                                                    <p class="content-box-header clearfix">
                                                        Submitter
                                                    </p>
                                                    <div class="content-box-wrapper">
                                                        <img class="img-circle" src="../..@Model.OwnerUser.ProfilePic" alt="" style="background-color: white; width: 100px; margin-bottom: 10px">
                                                        <div class="divider"></div>
                                                        <p><strong style="color: #00bca4">@Model.OwnerUser.FullName</strong></p>
                                                    </div>
                                                </div>
                                            </center>
                                        </div>
                                        <div class="col-md-6">
                                            <center>
                                                <div class="content-box border-top border-primary">
                                                    <p class="content-box-header clearfix">
                                                        Developer
                                                    </p>
                                                    <div class="content-box-wrapper">
                                                        @if (Model.AssignToUserId != null)
                                                        {
                                                            <img class="img-circle" src="../..@Model.AssignToUser.ProfilePic" alt="" style="background-color: white; width: 100px; margin-bottom: 10px">
                                                            <div class="divider"></div>
                                                            <p><strong style="color: #00bca4">@Model.AssignToUser.FullName</strong></p>
                                                        }
                                                        else
                                                        {
                                                            <div class="divider"></div>
                                                            <p>
                                                                <strong style="color: #00bca4">Not Yet Assigned</strong><br /><br />
                                                                <a href="@Url.Action("AssignDeveloper","Tickets", new { id = Model.Id })" class="btn btn-primary" style="color: white; text-decoration: none"><i class="glyph-icon icon-user" style="margin-right: 5px"></i> Assign</a>
                                                            </p>
                                                        }
                                                    </div>
                                                </div>
                                            </center>
                                        </div>
                                    </div>
                                    <dl class="dl-horizontal">

                                        <dt></dt>

                                        <dd>
                                            <blockquote>
                                                <p style="margin-bottom: 10px"><strong style="color: #00bca4">@Html.DisplayFor(model => model.Title)</strong></p>
                                                <p style="font-size: 13px">@Html.DisplayFor(model => model.Description)</p>
                                            </blockquote>
                                        </dd>

                                        <dt>
                                            Project
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.Project.Title)
                                        </dd>

                                        <dt>
                                            Type
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.TicketType.Name)
                                        </dd>

                                        <dt>
                                            Status
                                        </dt>

                                        <dd>
                                            @Html.DisplayFor(model => model.TicketStatus.Name)
                                        </dd>

                                        <dt>
                                            Created
                                        </dt>

                                        <dd>
                                            @Model.Created.ToString("MM/dd/yyyy") at @Model.Created.ToString("h:mm tt")
                                        </dd>
                                        @if (Model.Updated != null)
                                        {
                                            <dt>
                                                Updated
                                            </dt>

                                            <dd>
                                                @Model.Updated.Value.ToString("MM/dd/yyyy") at @Model.Updated.Value.ToString("h:mm tt")
                                            </dd>
                                        }

                                    </dl>
                                </div>
                                <h2 class="mrg20B" style="padding-top: 100px">Attachments</h2>
                                <div class="content-box pad20A">
                                    <p style="color: #00bca4; margin-bottom: 10px; font-size: 20px"><i class="glyph-icon icon-bullseye" style="font-size: 24px; margin-right: 1px"></i> DropZone<a href="javascript:void(0)" class="btn btn-primary btn-md pull-right" onclick="myUploadBtn()" style="margin-top: -3px">Upload</a></p>
                                    @using (Html.BeginForm("AddAttachment", "Tickets", new { ticketId = Model.Id }, FormMethod.Post, new { @class = "dropzone bg-gray center-margin dz-clickable", enctype = "multipart/form-data", style = "border: 2px solid #00bca4" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <div class="dz-default dz-message" style="padding-top: 0px">
                                            <i class="glyph-icon icon-files-o"></i><br />
                                            <span>Drop files here to upload</span>
                                        </div>
                                    }

                                    @if (Model.Attachments.Count > 0)
                                    {
                                        <h3 class="mrg20B" style="padding-top: 100px">Ticket Attachments</h3>
                                    }
                                    <div class="row" style="margin-bottom: 20px; margin-top: 20px">
                                        @foreach (var attachment in Model.Attachments)
                                        {
                                            <div class="modal fade" id="deleteAttachment-@attachment.Id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            <p class="modal-title">@attachment.FileUrl</p>
                                                        </div>
                                                        <div class="modal-body">
                                                            <p>Are you sure you want to delete this attachment?</p>
                                                        </div>
                                                        <div class="modal-footer">
                                                            @{
                                                                string attachFormId = "delAttachment" + attachment.Id;
                                                            }
                                                            @using (Html.BeginForm("DeleteAttachment", "Tickets", new { id = attachment.Id }, FormMethod.Post, new { id = attachFormId }))
                                                            {
                                                                @Html.AntiForgeryToken()
                                                            }
                                                            <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                                                            <button type="button" class="btn btn-primary" onclick="javascript:document.getElementById('@attachFormId').submit()">Yes</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <span class="btn-group pull-right" data-toggle="buttons" style="margin-top: 10px; z-index: 500; margin-right: 10px">
                                                    <span class="btn btn-default" data-toggle="modal" data-target="#deleteAttachment-@attachment.Id">
                                                        <i class="glyph-icon icon-close"></i>
                                                    </span>
                                                </span>
                                                <a href="/TicketAttachments/@Model.Id/@attachment.FileUrl" target="_blank" style="text-decoration: none !important">
                                                    <center>
                                                        <div class="content-box border-top border-red">
                                                            <p class="content-box-header clearfix">
                                                                @attachment.Extension
                                                            </p>
                                                            <div class="content-box-wrapper">
                                                                @if (attachment.Extension.ToLower() == "jpg" || attachment.Extension.ToLower() == "jpeg" || attachment.Extension.ToLower() == "png" || attachment.Extension.ToLower() == "gif" || attachment.Extension.ToLower() == "bmp")
                                                                {
                                                                    <i class="glyph-icon icon-file-image-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "doc" || attachment.Extension.ToLower() == "docx")
                                                                {
                                                                    <i class="glyph-icon icon-file-word-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "pdf")
                                                                {
                                                                    <i class="glyph-icon icon-file-pdf-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "txt" || attachment.Extension.ToLower() == "rtf")
                                                                {
                                                                    <i class="glyph-icon icon-file-text-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "xls" || attachment.Extension.ToLower() == "xlsx" || attachment.Extension.ToLower() == "csv")
                                                                {
                                                                    <i class="glyph-icon icon-file-excel-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "ppt" || attachment.Extension.ToLower() == "pptx")
                                                                {
                                                                    <i class="glyph-icon icon-file-powerpoint-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "mp4" || attachment.Extension.ToLower() == "mov" || attachment.Extension.ToLower() == "avi" || attachment.Extension.ToLower() == "wmv")
                                                                {
                                                                    <i class="glyph-icon icon-file-movie-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else if (attachment.Extension.ToLower() == "mp3" || attachment.Extension.ToLower() == "wav" || attachment.Extension.ToLower() == "wma")
                                                                {
                                                                    <i class="glyph-icon icon-file-audio-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                else
                                                                {
                                                                    <i class="glyph-icon icon-file-o" style="background-color: white; font-size: 30px"></i>
                                                                }
                                                                <i class="glyph-icon fileimag" style="background-color: white; font-size: 30px"></i>
                                                                <p style="margin-top: 20px; color: #8da0aa">
                                                                    <span class="text-no-wrap">uploaded by <span style="color: #00bca4 !important">@attachment.Author.FullName</span></span><br />
                                                                    <span class="text-no-wrap">@attachment.Created.ToString("M/dd/yyyy h:mm:ss tt")</span>
                                                                </p>
                                                                <div class="divider"></div>
                                                                <p><strong style="color: #e74c3c">@attachment.FileName</strong></p>
                                                            </div>
                                                        </div>
                                                    </center>
                                                </a>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <h2 class="mrg20B" style="padding-top: 100px">Comments</h2>
                                <div class="content-box">
                                    <div class="button-pane pad10A" style="background: #efefef">
                                        @using (Html.BeginForm("AddComment", "Tickets", new { ticketId = Model.Id }, FormMethod.Post))
                                        {
                                            @Html.AntiForgeryToken()
                                            <div class="input-group">
                                                <textarea type="text" name="body" rows="6" placeholder="Say something here..." class="form-control"></textarea>
                                                <button class="btn btn-primary pull-right" type="submit" style="margin-top: 10px">Submit</button>
                                            </div>
                                        }
                                    </div>
                                    @if (Model.Comments.Count > 0)
                                    {
                                        <hr style="margin-top: 0px" />
                                        <div class="content-box-wrapper">
                                            <ul class="chat-box">
                                                @foreach (var comment in Model.Comments.OrderByDescending(c => c.Id))
                                                {
                                                    if (comment.AuthorId == User.Identity.GetUserId())
                                                    {
                                                        <li class="float-right" style="clear: right">
                                                            <div class="chat-author">
                                                                <img width="36" src="../../@comment.Author.ProfilePic" alt="">
                                                            </div>
                                                            <div class="popover right no-shadow">
                                                                <div class="arrow"></div>
                                                                <div class="popover-content">
                                                                    <strong style="color: #00bca4">@comment.Author.FullName</strong><br />
                                                                    <hr />
                                                                    @comment.Body
                                                                    <div class="chat-time text-no-wrap">
                                                                        <i class="glyph-icon icon-clock-o"></i>
                                                                        @comment.Created.ToString("MM/dd/yyyy") at @comment.Created.ToString("h:mm tt")
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                        <li class="float-left" style="width: 100%; display: inline-block; margin-bottom: 0px"></li>
                                                    }
                                                    else
                                                    {
                                                        <li class="float-left" style="width: 100%; display: inline-block">
                                                            <div class="chat-author">
                                                                <img width="36" src="../../@comment.Author.ProfilePic" alt="">
                                                            </div>
                                                            <div class="popover left no-shadow">
                                                                <div class="arrow"></div>
                                                                <div class="popover-content">
                                                                    <strong style="color: #00bca4">@comment.Author.FullName</strong><br />
                                                                    <hr />
                                                                    @comment.Body
                                                                    <div class="chat-time text-no-wrap">
                                                                        <i class="glyph-icon icon-clock-o"></i>
                                                                        @comment.Created.ToString("MM/dd/yyyy") at @comment.Created.ToString("h:mm tt")
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                }
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="history">
            <h2 style="margin-bottom: 40px">Ticket History | <span style="color: #00bca4">#@Model.Id - @Model.Title</span><a href="@Url.Action("Index", "Home")" class="btn btn-black pull-right"><i class="glyph-icon icon-linecons-tag" style="margin-right: 10px"></i>Back to Tickets</a></h2>
            <div class="panel">
                <div class="panel-body">
                    <h3 class="title-hero">
                        Timeline
                    </h3>
                    <div class="example-box-wrapper">
                        <div class="timeline-box">
                            @{ 
                                var counter = 0;
                            }
                            @foreach (var hist in Model.Histories.OrderByDescending(h => h.Id))
                            {
                                counter++;
                                if (counter % 2 == 0)
                                {
                                    <div class="tl-row">
                                        <div class="tl-item float-right">
                                            @if (hist.Property.Contains("NEW"))
                                            {
                                                <div class="tl-icon" style="background-color: #00bca4; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            else if (hist.Property.Contains("DELETED") || hist.Property.Contains("REMOVED"))
                                            {
                                                <div class="tl-icon" style="background-color: #e74c3c; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="tl-icon" style="background-color: #8da0aa; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            <div class="tl-panel">
                                                @hist.Created.ToString("M/dd/yyyy h:mm tt")
                                            </div>
                                            <div class="popover left pull-left" style="min-width: 275px">
                                                <div class="arrow"></div>
                                                <div class="popover-content">
                                                    @if (hist.Property.Contains("NEW"))
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #00bca4; white-space: pre-wrap">@hist.Property</div>
                                                    }
                                                    else if (hist.Property.Contains("DELETED") || hist.Property.Contains("REMOVED"))
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #e74c3c; white-space: pre-wrap">@hist.Property</div>
                                                    }
                                                    else
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #8da0aa; white-space: pre-wrap">@hist.Property</div>
                                                    }                                                   
                                                    @if (hist.Property == "TICKET CREATED")
                                                    {
                                                        <p class="tl-content">
                                                            This ticket was created on this date at this time
                                                        </p>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE" || hist.Property == "PROJECT")
                                                    {
                                                        <p class="tl-content">
                                                            Changed from "@hist.OldValue" to "@hist.NewValue"
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW ATTACHMENT")
                                                    {
                                                        <p class="tl-content">
                                                            <a href="/TicketAttachments/@Model.Id/@hist.NewValue" target="_blank">@hist.NewValue</a>
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ATTACHMENT DELETED")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.NewValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW COMMENT")
                                                    {
                                                        <p class="tl-content">
                                                            <em>"@hist.NewValue"</em>
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW ASSIGNMENT")
                                                    {
                                                        <p class="tl-content">
                                                            Assigned to @hist.NewValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT CHANGE")
                                                    {
                                                        <p class="tl-content">
                                                            Assigned to @hist.NewValue
                                                            <br />
                                                            <br />
                                                            Previously assigned to @hist.OldValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer removed from Project)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because he/she was removed from the project
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer not on ticket Project)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because the ticket project changed and he/she was not part of the new project at this time
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer no longer in role)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because he/she lost their developer role
                                                        </p>
                                                    }
                                                    <hr />
                                                    <div class="tl-time" style="opacity: 1">
                                                        <img class="img-circle" src="../../@hist.Author.ProfilePic" alt="Profile image" style="background-color: white; width: 35px; margin-right: 5px;">
                                                        <span style="opacity: .4">@hist.Author.FullName</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="tl-row">
                                        <div class="tl-item">
                                            @if (hist.Property.Contains("NEW"))
                                            {
                                                <div class="tl-icon" style="background-color: #00bca4; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            else if (hist.Property.Contains("DELETED") || hist.Property.Contains("REMOVED"))
                                            {
                                                <div class="tl-icon" style="background-color: #e74c3c; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="tl-icon" style="background-color: #8da0aa; color: white">
                                                    @if (hist.Property.Contains("COMMENT"))
                                                    {
                                                        <i class="glyph-icon icon-comment"></i>
                                                    }
                                                    else if (hist.Property.Contains("ATTACHMENT"))
                                                    {
                                                        <i class="glyph-icon icon-file"></i>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE")
                                                    {
                                                        <i class="glyph-icon icon-tag"></i>
                                                    }
                                                    else if (hist.Property.Contains("PROJECT"))
                                                    {
                                                        <i class="glyph-icon icon-cog"></i>
                                                    }
                                                    else if (hist.Property.Contains("ASSIGNMENT"))
                                                    {
                                                        <i class="glyph-icon icon-user"></i>
                                                    }
                                                </div>
                                            }
                                            <div class="tl-panel">
                                                @hist.Created.ToString("M/dd/yyyy h:mm tt")
                                            </div>
                                            <div class="popover right pull-right" style="margin-right: 35px; min-width: 275px">
                                                <div class="arrow"></div>
                                                <div class="popover-content">
                                                    @if (hist.Property.Contains("NEW"))
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #00bca4; white-space: pre-wrap">@hist.Property</div>
                                                    }
                                                    else if (hist.Property.Contains("DELETED") || hist.Property.Contains("REMOVED"))
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #e74c3c; white-space: pre-wrap">@hist.Property</div>
                                                    }
                                                    else
                                                    {
                                                        <div class="tl-label bs-label label-success" style="background-color: #8da0aa; white-space: pre-wrap">@hist.Property</div>
                                                    }
                                                    @if (hist.Property == "TICKET CREATED")
                                                    {
                                                        <p class="tl-content">
                                                            This ticket was created on this date at this time
                                                        </p>
                                                    }
                                                    else if (hist.Property == "TITLE" || hist.Property == "DESCRIPTION" || hist.Property == "STATUS" || hist.Property == "PRIORITY" || hist.Property == "TYPE" || hist.Property == "PROJECT")
                                                    {
                                                        <p class="tl-content">
                                                            Changed from "@hist.OldValue" to "@hist.NewValue"
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW ATTACHMENT")
                                                    {
                                                        <p class="tl-content">
                                                            <a href="/TicketAttachments/@Model.Id/@hist.NewValue" target="_blank">@hist.NewValue</a>
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ATTACHMENT DELETED")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.NewValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW COMMENT")
                                                    {
                                                        <p class="tl-content">
                                                            <em>"@hist.NewValue"</em>
                                                        </p>
                                                    }
                                                    else if (hist.Property == "NEW ASSIGNMENT")
                                                    {
                                                        <p class="tl-content">
                                                            Assigned to @hist.NewValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT CHANGE")
                                                    {
                                                        <p class="tl-content">
                                                            Assigned to @hist.NewValue
                                                            <br />
                                                            <br />
                                                            Previously assigned to @hist.OldValue
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer removed from Project)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because he/she was removed from the project
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer not on ticket Project)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because the ticket project changed and he/she was not part of the new project at this time
                                                        </p>
                                                    }
                                                    else if (hist.Property == "ASSIGNMENT REMOVED (Developer no longer in role)")
                                                    {
                                                        <p class="tl-content">
                                                            @hist.OldValue was removed as the assigned developer on this ticket because he/she lost their developer role
                                                        </p>
                                                    }
                                                    <hr />
                                                    <div class="tl-time" style="opacity: 1; margin-top: 10px">
                                                        <img class="img-circle" src="../../@hist.Author.ProfilePic" alt="Profile image" style="background-color: white; width: 35px; margin-right: 5px;">
                                                        <span style="opacity: .4">@hist.Author.FullName</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }                                           
                        </div>
                        <center>
                            <div style="margin-top: 40px; margin-bottom: 40px">
                                <a href="javascript:;" id="scrollToTop" class="btn btn-primary" style="color: white; text-decoration: none"><i class="glyph-icon icon-arrow-up" style="margin-right: 15px"></i> Back to the Top <i class="glyph-icon icon-arrow-up" style="margin-left: 15px"></i></a>
                            </div>
                        </center>  
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script type="text/javascript" src="../../assets/widgets/sticky/sticky.js"></script>
    <script type="text/javascript" src="../../assets/widgets/tocify/tocify.js"></script>
    <script src="~/assets/widgets/dropzone/dropzone.js"></script>
    <script type="text/javascript">
        $(function () {
            var toc = $("#tocify-menu").tocify({ context: ".toc-tocify", showEffect: "fadeIn", extendPage: false, selectors: "h2, h3, h4" });
        });
        jQuery(document).ready(function ($) {

            /* Sticky bars */

            $(function () {
                "use strict";

                $('.sticky-nav').hcSticky({
                    top: 90,
                    innerTop: 10,
                    stickTo: 'document'
                });

            });

        });

        //Go to a attachment section after reloading page
        function myUploadBtn(reload) {
            window.location.hash = "#TicketAttachments";
            window.location.reload(true);
        };
    </script>
    <script>
            /*============================================
            ScrollTo Links
            ==============================================*/

            $(function () {
                $('#scrollToBottom').bind("click", function () {
                    $('html, body').animate({ scrollTop: $(document).height() });
                    return false;
                });
                $('#scrollToTop').bind("click", function () {
                    $('html, body').animate({ scrollTop: 0 });
                    return false;
                });
            });
    </script>
}
